/* curtin-library.bitbucket.org/virtual-bookshelf/LICENSE */(function($){var E=1<window.devicePixelRatio?window.devicePixelRatio:1;function F(){return(new Date).getTime()}var aa="Webkit Moz O Ms Khtml webkit moz o ms khtml".split(" ");function I(b,a){if(b)for(var c=1;c<arguments.length;++c){var g=arguments[c];if(g in b)return g;for(var g=g.slice(0,1).toUpperCase()+g.slice(1),p=0;p<aa.length;++p){var q=aa[p]+g;if(q in b)return q}}}function J(b,a,c){b.each(function(){var b=I(this.style,a);b&&(this.style[b]=c)})}
var K=function(){var b=I(window,"requestAnimationFrame");return b?function(a){return window[b](a)}:function(a){return window.setTimeout(a,1)}}(),ba=function(){var b=I(window,"cancelAnimationFrame","cancelRequestAnimationFrame")||"clearTimeout";return function(a){window[b](a)}}();function ca(b){b&&b.remove&&b.remove()}function da(b){this.a=b}da.prototype.next=function(){this.a=279470273*this.a%4294967291;return this.a/4294967291};var L="ontouchstart"in window;
function ka(b,a){function c(a){return b&&v[a.type].apply(this,arguments)}function g(a){a({pageX:f[f.length-1].x,pageY:f[f.length-1].y,e:l.x,O:l.y,L:s,Q:B})}function p(){u&&(u=!1,d&&(d.unbind("mouseup dragstart losecapture",c),d.get(0).releaseCapture(),d=void 0),$(window).unbind("mouseup dragstart mousemove",c))}function q(a,g){e=a;l={x:g.pageX,y:g.pageY,time:F()};f=[l];B=s=0;L||u||(u=!0,h&&!d&&(d=b,d.bind("mouseup dragstart losecapture",c),d.get(0).setCapture(!1)),$(window).bind("mouseup dragstart mousemove",c))}
function n(a){var c=f[f.length-1];a={x:a.pageX,y:a.pageY,time:F()};for(f.push(a);2<f.length&&100<a.time-f[0].time;)f.shift();var b=f[0];if(500<=a.time-b.time)f.shift(),B=s=0;else{var d=a.time-b.time;0<d&&(s=(a.x-b.x)/d,B=(a.y-b.y)/d)}return a.x!=c.x||a.y!=c.y}function t(c,b){if(n(c)){var d=f[f.length-1];if(!m){var s=6<=Math.abs(d.x-l.x),d=6<=Math.abs(d.y-l.y);a.r&&s||a.s&&d?m=!0:L&&(!a.r&&s||!a.s&&d)&&r(c,!0)}m&&b.preventDefault();void 0!==e&&g(a.J)}}function r(c,d){p();e=void 0;x&&(m?setTimeout(x,
1):x(),x=null);m=!1;c&&n(c);d&&(B=s=0);g(a.I)}function k(c){var d=A;A={pageX:c.pageX,pageY:c.pageY};(d?a.G:a.H)({pageX:c.pageX,pageY:c.pageY})}var h=b.get(0).setCapture&&b.get(0).releaseCapture,e,m,u,d,l,f,s,B,A,x=null,v={},C=Infinity;v.touchstart=function(c){if(void 0!==e){for(var d=c.touches||c.originalEvent.touches,b=!1,f=0;f<d.length&&!(b=d[f].identifier==e);++f);b||r(void 0,!0)}void 0!==e||c.defaultPrevented||(c=(c.changedTouches||c.originalEvent.changedTouches)[0],q(c.identifier,c),g(a.t))};
v.touchmove=function(a){for(var c=a.changedTouches||a.originalEvent.changedTouches,d=0;d<c.length;++d){var b=c[d];if(b.identifier==e){t(b,a);break}}};v.touchend=function(a){for(var c=a.changedTouches||a.originalEvent.changedTouches,d=0;d<c.length;++d){var b=c[d];if(b.identifier==e){r(b,"touchcancel"==a.type);break}}};v.touchcancel=v.touchend;v.mouseenter=function(a){d||k(a)};v.mouseleave=function(){d||A&&(A=void 0)};v.mousedown=function(c){if(1==c.which&&void 0===e&&!c.defaultPrevented){q("mouse",
c);e="mouse";g(a.t);if(c.target&&!x){var d=$(c.target),b=function(c){c.stopPropagation();return!1};x=function(){d.unbind("click",b)};d.bind("click",b)}return!1}};v.mousemove=function(c){"mouse"==e?(h&&($(c.target).closest(b).length?k(c):A&&(A=void 0)),t(c,c)):void 0===e&&k(c)};v.mouseup=function(c){1==c.which&&"mouse"==e&&r(c,!1)};v.dragstart=function(){return!1};v.mousewheel=v.DOMMouseScroll=function(c){var d=c.originalEvent;if(!d.defaultPrevented){var b=-d.detail||d.wheelDelta/120||0,f=0,e=b;void 0!==
d.axis&&d.axis===d.HORIZONTAL_AXIS?(e=0,f=b):void 0!==d.wheelDeltaX&&void 0!==d.wheelDeltaY&&(f=d.wheelDeltaX/120,e=d.wheelDeltaY/120);0!=b&&(C=Math.max(1,Math.min(Math.abs(b),C)),a.K({M:b,deltaX:f,deltaY:e,step:b/C,u:f/C,P:e/C}),c.preventDefault())}};v.losecapture=v.contextmenu=function(){void 0!==e&&r(void 0,!0)};v.selectstart=function(){return!1};this.remove=function(){L?b.unbind("touchstart touchmove touchend touchcancel",c):b.unbind("mousedown mouseenter mouseleave mousemove contextmenu mousewheel DOMMouseScroll selectstart",
c);p();x&&(x(),x=null)};L?b.bind("touchstart touchmove touchend touchcancel",c):b.bind("mousedown mouseenter mouseleave mousemove contextmenu mousewheel DOMMouseScroll selectstart",c)};var M;function P(b){this.element=b;this.a=this.element.get(0);M(this.a)}function Q(b,a,c,g,p){this.element=b;this.a=this.element.get(0);this.x=a;this.y=c;this.width=g;this.height=p;M(this.a)}
(function(){var b=$("<div>").get(0).style,a=I(b,"transform"),c=I(b,"transformOrigin");M=c?function(a){a.style.position="absolute";a.style[c]="0 0";a.style.left=0;a.style.top=0}:function(c){c.style.position="absolute"};a&&c&&I(b,"perspective")?(P.prototype.b=function(c,b){this.a.style[a]="translate3d("+c.toFixed(3)+"px,"+b.toFixed(3)+"px,0)"},Q.prototype.b=function(c,b,q,n,t){this.a.style[a]="translate3d("+(c+this.x*n).toFixed(3)+"px,"+(b+this.y*t).toFixed(3)+"px,0) scale3d("+n.toFixed(3)+","+t.toFixed(3)+
",1)";this.a.style.zIndex=Math.floor(q)}):(P.prototype.b=function(c,a){this.a.style.left=Math.round(c)+"px";this.a.style.top=Math.round(a)+"px"},Q.prototype.b=function(c,a,b,n,t){c+=this.x*n;a+=this.y*t;n=c+this.width*n;t=a+this.height*t;c=Math.round(c);a=Math.round(a);this.a.style.left=c+"px";this.a.style.top=a+"px";this.a.style.width=Math.round(n-c)+"px";this.a.style.height=Math.round(t-a)+"px";this.a.style.zIndex=Math.floor(b)})})();function R(b,a,c){function g(a,ga){d.splice(ga,0,this);this.A=a;this.a=[];this.loaded=!1;this.h=this.next=null;this.width=0;var e=this;l.loadSegment(a,f,function(a){if(!e.B){var w=a.length;e.i=a;e.next=a.next;e.h=a.prev;e.next!=e||w||delete e.next;e.h!=e||w||delete e.h;e.b&&e.b.remove();e.b=c.l(a,b);e.loaded=!0;e.width=w*c.c;if(ga==d.length-1)for(w=0;w<a.length;++w)e.a.push(l.createItem(e.i,w,f));else for(w=a.length-1;0<=w;--w)e.a[w]=l.createItem(e.i,w,f);for(w=0;w<e.a.length;++w)e.b.m(e.a[w],w);
e.q();D=null;u()}});this.loaded||(this.width=c.c,this.b=c.k(b),this.q())}function p(c,a,b){n();c=Math.round(d[0].x+c);for(var e=0;e<d.length;++e){var f=d[e];f.e=f.x;f.d=c;c+=f.width}u();x=F();v=a;C=b;s=K(t)}function q(){for(var c=0;c<d.length;++c){var a=d[c];a.x=a.e=a.d}u();e()}function n(){clearTimeout(G);G=void 0;ba(s);s=void 0}function t(){s=void 0;var a=F()-x;if(a>=v)q();else{C(a);var a=c.marginWidth,b=c.f-c.marginWidth;if(d[0].x>a){for(b=0;b<d.length;++b){var e=d[b];e.d=a;a+=e.width}q()}else if(d[d.length-
1].x+d[d.length-1].width<b){a=b;for(b=d.length-1;0<=b;--b)e=d[b],a-=e.width,e.d=a;q()}else s=K(t)}m(!1)}function r(a){y=a;ea=0<y?-1:1;a=.5*y*y/(0>y?-z:z);if(ma){var b=d[0].x-c.marginWidth+a;a+=Math.round(b/c.c)*c.c-b}b=(d[0].x-c.marginWidth)/c.c;if(0>a){var b=Math.ceil(b)-b,e=Math.ceil(b-a/c.c);e>N&&(a=(b-N)*c.c)}else b-=Math.floor(b),e=Math.ceil(b+a/c.c),e>N&&(a=(N-b)*c.c);0!=a&&(y=Math.sqrt(Math.abs(a*z*2)),0>a&&(y=-y),p(a,y/(0>y?-z:z),k))}function k(a){for(var c=0>y?-z:z,b=0;b<d.length;++b){var e=
d[b];e.x=e.e+y*a-.5*c*a*a}}function h(a){a=.5*(1-Math.cos(a/v*Math.PI));for(var c=0;c<d.length;++c){var b=d[c];b.x=b.e+a*(b.d-b.e)}}function e(){void 0===s&&void 0===G&&0<d.length&&!H&&null!=fa&&(G=window.setTimeout(function(){G=void 0;var a=(c.marginWidth-d[0].x)%c.c,b=.25*c.j;if(0>ea){for(;a<=b;)a+=c.c;a+=0*c.c}else{for(;a>=-b;)a-=c.c;a-=0*c.c}p(a,na,h)},fa))}function m(a){for(var c=0;c<d.length;++c)d[c].v(a)}function u(){void 0===B&&(B=setTimeout(function(){B=void 0;if(d.length){for(var a=c.f,
b=d[0],e=d[d.length-1];Math.max(b.x,b.d)+b.width<-ha;)d.shift().remove(),b=d[0];for(;Math.min(e.x,e.d)>a+ha;)d.pop().remove(),e=d[d.length-1];Math.max(b.x,b.d)>-ia&&null!=b.h&&new g(b.h,0);Math.min(e.x,e.d)+e.width<a+ia&&null!=e.next&&new g(e.next,d.length)}},1))}var d=[],l=a.stream,f,s,B,A,x,v,C,z=a.drag||.002,y,G,ea=0>a.stepDirection?-1:1,fa="stepInterval"in a?a.stepInterval:3E3,na="stepDuration"in a?a.stepDuration:1E3,H,ja="preload"in a?a.preload:20,ia=c.c*ja,ha=c.c*ja*3/2,D=a.startItem,U=null,
ma=a.rounding,O=a.maxThrowVelocity||4,N=a.maxThrowItems||Infinity;g.prototype.q=function(){var a=d[1],b=d[d.length-2];if(this.loaded&&null!==D){if("function"==typeof D)for(a=D,D=null,b=0;b<this.a.length;++b)if(a(this.a[b])){D=b;break}0<=D&&D<this.a.length?this.x=(c.f-c.c)/2-D*c.c:this.x=c.marginWidth;this.d=this.e=this.x;D=null}else this==d[0]&&a&&a.loaded?(this.x=a.x-this.width,this.e=a.e-this.width,this.d=a.d-this.width):this==d[d.length-1]&&b&&b.loaded?(this.x=b.x+b.width,this.e=b.e+b.width,this.d=
b.d+b.width):this.d=this.e=this.x=c.marginWidth;this.v(!1)};g.prototype.v=function(b){this.b.g(this.x,b);b=Math.floor((c.f/2-this.x)/c.c);if(0<=b&&b<this.a.length&&this.a[b]!=U&&(U=this.a[b],a.onItemFocused))a.onItemFocused(U,this.A,b)};g.prototype.remove=function(){this.B=!0;this.b&&this.b.remove();for(delete this.i;this.a.length;)ca(this.a.pop())};this.remove=function(){clearTimeout(B);B=void 0;clearTimeout(A);A=void 0;for(n();0<d.length;)ca(d.pop())};this.refresh=function(){void 0===s&&void 0===
A&&(A=setTimeout(function(){A=void 0;m(!0);u()},0))};this.a=function(a){if(!H&&0<d.length){var b=0<a?c.f+c.c-c.j-c.marginWidth:c.marginWidth;a=(0<a?Math.floor:Math.ceil)((d[0].d-b)/c.c-a+(0<a?1:-1)*c.p)*c.c+b-d[0].x;b=Math.sqrt(Math.abs(2*a*z));0>a&&(b=-b);r(b)}};this.b=function(a){this.a(a*Math.max(1,Math.floor((c.f-2*c.marginWidth)/c.c)))};f={itemWidth:c.D||c.j,itemHeight:c.C||c.n,itemSpacing:c.c,refresh:this.refresh};new g(a.startSegment||0,0);u();new ka(b,{r:!0,s:!1,t:function(){if(H=1<d.length||
d[0].loaded){n();for(var a=y=0;a<d.length;++a){var b=d[a];b.e=b.d=b.x}}},J:function(a){if(H){a=a.pageX-a.e;var b=c.f,e=d[0],f=e.e;null!=e.h&&(f-=c.c);var s=d[d.length-1],e=s.e+s.width;null!=s.next&&(e+=c.c);s=c.marginWidth;a=Math.max(a,b-c.marginWidth-e);a=Math.min(a,s-f);for(b=0;b<d.length;++b)f=d[b],f.x=f.d=f.e+a;m(!1);u()}},I:function(a){H&&(r(Math.max(-O,Math.min(a.L,O))),H=!1,e())},K:function(a){if(!H&&0<d.length){a=d[0].d-d[0].x+(Math.abs(a.step)>=Math.abs(a.u)?a.step:a.u)*c.c;var b=Math.sqrt(Math.abs(2*
a*z));0>a&&(b=-b);r(Math.max(-O,Math.min(b,O)))}},H:function(){},N:function(){},G:function(){clearTimeout(G);G=void 0;e()}});e()};function S(b,a){function c(){n||(n=!0,q.onload=null,q.onerror=null,p.width=a.itemWidth,p.height=Math.round(this.height*a.itemWidth/this.width),p.height>a.itemHeight&&(p.width=Math.round(this.width*a.itemHeight/this.height),p.height=a.itemHeight),g.width(p.width).height(p.height).append($(q).css({width:"100%",height:"100%",border:"none"})),a.refresh())}var g=$("<a>").css("display","inline-block");$.extend(g.get(0),{href:b.link,target:b.target,title:b.title});this.element=g;this.height=this.width=0;
this.data=b;var p=this,q=new Image,n=!1;q.onload=c;q.onerror=c;q.src=b.image;q.complete&&c.call(q)};var la=$.browser.msie&&/^[1-8]\./.test($.browser.version),T,V=[];function W(){T=null;try{V.shift()()}finally{V.length&&(T=setTimeout(W,1))}};function X(b,a){a=a||{};this.b=b;this.a={F:!("looping"in a)||a.looping,o:a.itemType||S}}X.prototype.loadSegment=function(b,a,c){a=this.a.F?b:void 0;c({id:b,prev:a,next:a,length:this.b.length})};X.prototype.createItem=function(b,a,c){return new this.a.o(this.b[a],c)};function Y(b,a){a=a||{};this.b=b;this.a={o:a.itemType||S}}Y.prototype.loadSegment=function(b,a,c){$.getJSON(this.b+b,function(a){c({id:b,prev:a.prev,next:a.next,length:a.items.length,w:a.items})})};Y.prototype.createItem=function(b,a,c){return new this.a.o(b.w[a],c)};var Z=window.VirtualBookshelf||(window.VirtualBookshelf={});
Z.Bookshelf=function(b,a){function c(a,b){this.a=[];this.element=$("<div>").css({width:a.length*t+"px",height:n+"px"});this.i=new P(this.element);b.append(this.element)}b=$(b);J(b,"userSelect","none");b.css("overflow","hidden");/^(absolute|fixed)$/.test(b.css("position"))||b.css("position","relative");var g=a.spacing||1,p=b.width(),q=b.height(),n=a.itemHeight||q,t=a.itemWidth||n*(a.itemAspect||1),q=a.marginWidth||0,r=Math.round(t*g);c.prototype.g=function(a,b){this.i.b(Math.round(a*E)/E,0);if(b)for(var c=
0;c<this.a.length;++c)this.b(this.a[c],c)};c.prototype.m=function(a,b){this.a[b]=a;$(a.element).css("position","absolute");this.b(a,b);this.element.append(a.element)};c.prototype.b=function(a,b){var c=null!=a.height?a.height:n,d=null!=a.width?a.width:t;$(a.element).css("top",Math.round(n-c)+"px").css("left",Math.round(r*b+(t-d)/2)+"px")};c.prototype.remove=function(){this.element.remove()};var k={j:t,n:n,c:r,f:p,marginWidth:q,p:.9,l:function(a,b){return new c(a,b)},k:function(a){a=new c({length:1},
a);a.element.append($("<div>").css({width:t+"px",height:n+"px"}));return a}},h=new R(b,a,k);this.remove=function(){h.remove();h=void 0};this.refresh=function(){k.f=p=b.width();h.refresh()};this.step=function(a){h.a(a)};this.stepPage=function(a){h.b(a)}};
Z.Carousel=function(b,a){function c(a,b){this.b=b;this.a=[];this.visible=!1}function g(a,b){this.element=$(a.element).hide();this.b=a;this.visible=!1;this.a=new Q(this.element,0,0,0,0);b.append(this.element)}b=$(b);J(b,"userSelect","none");b.css("user-select","none");/^(absolute|fixed)$/.test(b.css("position"))||b.css("position","relative");var p=a.spacing||1.2,q=a.tilt||0,n="perspective"in a?a.perspective:1,t=b.width(),r=b.height(),k=a.itemHeight||r,h=a.itemWidth||k*(a.itemAspect||1),e=h*p,m="fade"in
a?a.fade:.1,u=p*t/2,d=Math.PI*u;"startItem"in a||(a.startItem=Math.ceil(d/2/e));c.prototype.g=function(a){this.visible||(this.visible=a<d&&a>-this.a.length*e);if(this.visible){for(var b,c=0;c<this.a.length;++c){var m=this.a[c];m.g(a+e*c);b=b||m.visible}this.visible=b}};c.prototype.m=function(a,b){this.a[b]=new g(a,this.b)};c.prototype.remove=function(){for(var a=0;a<this.a.length;++a)this.a[a].element.remove()};g.prototype.g=function(a){a=(e+a)/(e+d);var b=0<a&&1>a&&0<this.b.width&&0<this.b.height;
if(b){var c=a*Math.PI,g=1-Math.sin(c),l=1/(1+n*g),c=t/2-l*u*Math.cos(c),p=r*q*g,C=this.b.width,z=this.b.height;this.a.x=(h-C)/2;this.a.y=k-z;this.a.width=C;this.a.height=z;this.a.b(c-l*h/2,p+k-l*k,1E3*(1-g),l,l);this.element.css("opacity",(a<m?a/m:a>1-m?(1-a)/m:1).toFixed(3))}this.visible!=b&&(this.visible=b,this.element.toggle(b))};var l=new R(b,a,{j:h,n:k,c:e,f:d,marginWidth:(d-e)/2,p:.5,l:function(a,b){return new c(0,b)},k:function(a){return new c(0,a)}});this.remove=function(){l.remove();l=void 0};
this.refresh=function(){l.refresh()};this.step=function(a){l.a(a)}};
Z.Train=function(b,a){function c(a,b){this.b=b;this.a=[];this.visible=!1}function g(a,b){this.element=$(a.element).hide();this.b=a;this.visible=!1;this.a=new Q(this.element,0,0,0,0);b.append(this.element)}b=$(b);J(b,"userSelect","none");b.css("user-select","none");b.css("overflow","hidden");/^absolute|fixed$/.test(b.css("position"))||b.css("position","relative");var p=a.spacing||1.1,q=b.width(),n=b.height(),t=a.itemHeight||n,r=a.itemWidth||t*(a.itemAspect||.8),k=r*(a.unfocusedScale||.2),h=k*p,e="unfocusedOpacity"in
a?a.unfocusedOpacity:.5,m="transitionOverlap"in a?a.transitionOverlap:.15,u="transitionFade"in a?a.transitionFade:.2,d="focusedPosition"in a?a.focusedPosition:.5,l=q*(1+2*Math.abs(d-.5));"startItem"in a||(a.startItem=Math.ceil(l/2/h));"maxThrowVelocity"in a||(a.maxThrowVelocity=1);"rounding"in a||(a.rounding=!0);c.prototype.g=function(a){this.visible||(this.visible=a<l&&a>-this.a.length*h);if(this.visible){for(var b,c=0;c<this.a.length;++c){var d=this.a[c];d.g(a+h*c);b=b||d.visible}this.visible=b}};
c.prototype.m=function(a,b){this.a[b]=new g(a,this.b)};c.prototype.remove=function(){for(var a=0;a<this.a.length;++a)this.a[a].element.remove()};g.prototype.g=function(a){var b=(h+a)/(h+l);if(b=0<b&&1>b){var c=this.b.width,f=this.b.height;this.a.x=-c/2;this.a.y=0;this.a.width=c;this.a.height=f;var c=Math.max(0,1-Math.abs(a-(l-h)/2)/((1+m)*h/2)),c=.5*(1-Math.cos(c*Math.PI)),g=k/r*(1-c)+c;a+=h/2;.5>d&&(a+=q-l);this.a.b(a,(n-g*f)/2,1E3*c,g,g);a=c/u;a=Math.min(1,e*(1-a)+a);this.element.css("opacity",
a.toFixed(3))}this.visible!=b&&(this.visible=b,this.element.toggle(b))};var f=new R(b,a,{j:k,n:t,c:h,D:r,C:t,f:l,marginWidth:(l-h)/2,p:.5,l:function(a,b){return new c(0,b)},k:function(a){return new c(0,a)}});this.remove=function(){f.remove();f=void 0};this.refresh=function(){f.refresh()};this.step=function(a){f.a(a)}};Z.ArrayStream=X;Z.JSONStream=Y;
Z.FadeTransition=function(b,a,c,g){function p(a,b){a.css("opacity",Math.max(.01,Math.min(b,1)))}function q(){l=d=void 0;var f=F();u&&(m&&(f<e?p(h,(e-f)/a):(h.remove(),m=!1)),m||(h=u,u=void 0,e=Math.max(f,Math.max(f,k)+c)+g));h&&!u&&f>=e-g&&(m||(h=$(h)),p(h,1-(e-f)/g),m||(b.append(h),m=!0));r&&(f<k?p(r,(k-f)/a):(r.remove(),r=void 0));r||f>=e-g&&f<e?d=K(q):f<e&&(l=setTimeout(q,e-g-f))}function n(){clearTimeout(l);l=void 0;ba(d);d=void 0}c=c||0;g=0<=g?g:a;var t=F(),r,k=t,h,e=t,m,u,d,l;this.show=function(b){n();
if(!u){var c=F();e=c+Math.min(1,1-(e-c)/g)*a}u=b;r||(m&&(r=h,k=e,m=!1),h=void 0);q()};this.remove=n};Z.SimpleItem=S;
Z.SubstituteImage=function(b,a,c,g,p,q,n){function t(a){if(la){var b=a.position();a.before($('<div class="shelf-ie-box-shadow">').css({left:b.left-5+"px",top:b.top-4+"px",width:a.outerWidth()+"px",height:a.outerHeight()+"px"}))}else J(a,"boxShadow",n.boxShadow)}function r(){var a=new da(c),m="rgb(#,#,#)".replace(/#/g,function(){return Math.floor(256*(.4+.4*a.next()))}),m=$('<div class="shelf-image-substitute">').css("background-color",m);b.append(m);var h,d=m.width(),l=m.height(),f=$('<div class="shelf-image-authors static">');
if(q)for(var s=0;s<q.length;++s)f.append($("<div>").text(q[s]));m.append(f);for(h=n.authorsFontSize;1<h&&(f.outerHeight()>n.authorsMaxHeight||f.outerWidth()>d);)--h,f.css("font-size",h+"px");f.removeClass("static");var k,r=0;if(p){k=$('<div class="shelf-image-subtitle">').text(p);m.prepend("<br>").prepend(k);for(h=n.subtitleFontSize;1<h&&(k.outerHeight()>n.subtitleMaxHeight||k.outerWidth()>d);)--h,k.css("font-size",h+"px");r=k.outerHeight()}s=$('<div class="shelf-image-title">').text(g);m.prepend("<br>").prepend(s);
h=n.titleFontSize;for(var x=l-f.outerHeight()-r;1<h&&(s.outerHeight()>x||s.outerWidth()>d);)--h,m.css("font-size",h+"px");d=s.outerHeight()+r;l=Math.floor(Math.max(0,Math.min(.2*(l-d),(l-f.outerHeight()-d)/2)));s.css("top",l+"px");k&&k.css("top",l+"px");la&&(m.addClass("shelf-ie-no-text-shadow"),s.prepend($('<div class="shelf-ie-text-shadow">').text(g)),k&&k.prepend($('<div class="shelf-ie-text-shadow">').text(p)),f.prepend($('<div class="shelf-ie-text-shadow">').append(f.children().clone())));t(m);
m.prepend($('<div class="shelf-image-bg">').css("background-image",'url("'+n.background+'")'))}if(a){var k=new Image,h=function(){k.onload=null;k.onerror=null;setTimeout(function(){var a=k.width,c=k.height;if(1<a&&1<c){var g=$(k),d=b.width(),h=b.height();c>h&&(a=Math.round(a*h/c),c=h);a>d&&(c=Math.round(c*d/a),a=d);g.css({width:a.toFixed()+"px",height:c.toFixed()+"px",position:"relative",top:(h-c).toFixed()+"px"});b.append(g);t(g)}else V.push(r),T||(T=setTimeout(W,1))},1)};k.onload=h;k.onerror=h;
k.src=a}else V.push(r),T||(T=setTimeout(W,1))};})(jQuery)
